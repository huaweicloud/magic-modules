<% prefix = stage + resource_name + titlelize(api.name) -%>
func build<%= prefix -%>Parameters(opts map[string]interface{}, arrayIndex map[string]int) (interface{}, error) {
    params := make(map[string]interface{})
<%= lines(build_expand_properties(stage, api.parameters, "opts, arrayIndex", prefix, "params", true), 1) %>
<% if api.msg_prefix.nil? -%>
    return params, nil
<% else -%>
<%   items = api.msg_prefix.split(".")
     array_items = api.msg_prefix_array_items || []
-%>
    p := params
<%   while !items.empty? do -%>
<%     ai = items.join(".") -%>
<%     if array_items.include?(ai) -%>
    p = map[string]interface{} {"<%= items.pop %>": []interface{} {p}}
<%     else -%>
    p = map[string]interface{} {"<%= items.pop %>": p}
<%     end%>

<%   end -%>
    return p, nil
<% end -%>
}

<% api.parameters.each do |prop| -%>
<%= lines(build_expand_method(resource, stage, prefix, prop), 1) -%>
<% end -%>
