<% prefix = sprintf("%s%s%s", stage, stage.empty? ? "" : "_", api.out_name) -%>
def build_<%= prefix -%>_parameters(opts):
    params = dict()
<%= lines(build_expand_properties(stage, api.parameters, "opts, None", prefix, "params", true), 1) %>
<% if api.msg_prefix.nil? -%>
    return params
<% else -%>
<%   items = api.msg_prefix.split(".")
     array_items = api.msg_prefix_array_items || []
-%>
<%   while !items.empty? do -%>
<%     ai = items.join(".") -%>
<%     if array_items.include?(ai) -%>
    params = {"<%= items.pop %>": [params]}
<%     else -%>
    params = {"<%= items.pop %>": params}
<%     end%>

<%   end -%>
    return params
<% end -%>
}

<% api.parameters.each do |prop| -%>
<%= lines(build_expand_method(resource, stage, prefix, prop), 1) -%>
<% end -%>
